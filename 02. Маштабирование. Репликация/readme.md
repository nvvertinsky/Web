# Маштабирование.

### Вертикальное. 
Увеличиваем ресурсы одного сервера, где крутится приложение.

### Горизонтальное. 
Когда увеличиваем кол-во серверов и на каждом будет крутится свое приложение. А распределять нагрузку будет балансировщик.
Когда нагрузка большая, то мы можем увеличить количество серверов с приложением. А когда нагрузка упала, то можем выключать эти серверы. Так может быть дешевле, чем один большой сервер с постоянной максимальной конфигурацией


### Горизонтальное маштабирование БД
  1. Допустим у нас в начале есть небольшая БД на сервере. 
  2. По мере поступления нагрузки (больше подключений в секунду, больше оперативной памяти, больше памяти жесткого диска) мы можем просто увеличивать ресурсы севера. 
  3. Но ресурсы сервера не бесконечны. Плюс слишком большие ресурсы могут стоить значительно дороже, чем просто новый сервер.
  4. Придется покупать еще один сервер.
  5. Разделим данные. Одни данные будет на одном сервере хранить, другие на другом. По сути сделаем секционирование данных по серверам. 
  6. Секционирование можно сделать по разным ключам. Например по хеш или по диапазону или по списку. 
  7. Получается нам нужна некая прокладка к которой мы будем обращаться и которая будет знать где находятся нужные нам данные.
  8. Единого способа такой маршрутизации нет. Каждый делает как ему надо. 
  9. Нормальный вариант - это на каждом сервере устанавливаем базу данных.
  10. Создаем таблицы, которые хотим партиционировать по шардам.
  11. Будет делать hash партиционирование. То есть брать PK таблицы и прогонять его через хеш функцию. 
  12. Дальше в самом приложении делаем справочник, где будет хранится хеш значение и номер шарда для него.
  13. Сопоставляем полученное хеш значение с хранимым и получаем номер шарда. 
  14. Проблема будет когда добавим новый шард. Хеш функция будет учитывать новое кол-во шардов и будет возвращать для каждое ключа уже новое значение хеша. 
  15. Придется делать ребалансировку всех шардов. То есть вручную перегонять все данные из одного шарда в другой.
  16. Можно сделать вообще без прокладки, просто проходится по всем серверам. Но это долго и не эффективно. 
  
У некоторый баз данных, есть шардирование из коробки. Под капотом они используют либо шардирование по хешу, либо по диапазону.


# Репликация.
  1. Для этого создаем еще один сервер или несколько серверов. 
  2. Клонируем туда все данные. 
  3. Выбираем какая будет мастер реплика. В нее будем делать DML. 
  4. Из остальных реплик можно делать SELECT запросы. 
  5. Мастер реплика может записывать синхронно все изменения. Тогда операция будет выполняться дольше.
  6. Мастер реплика может так же записывать ассинхронно. Все зависит от требований.
  7. Между приложением и базой можно поставить балансировщик, чтобы распределял подключения. 
  8. Если мастер стал не доступен, другая реплика должна взять на себя DML операции. 




